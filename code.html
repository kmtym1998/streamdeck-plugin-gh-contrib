<!DOCTYPE html>
<html>
  <head>
    <title>com.elgato.counter-clone</title>
    <meta charset="utf-8" />
  </head>

  <body>
    <script>
      let websocket = null;
      let pluginUUID = null;
      let timer;

      const quartileImage = Object.freeze({
        FIRST_QUARTILE:
          'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAlwAAAJcCAYAAAAsHHqwAAABaWlDQ1BEaXNwbGF5IFAzAAAokXWQvUvDUBTFT6tS0DqIDh0cMolD1NIKdnFoKxRFMFQFq1OafgltfCQpUnETVyn4H1jBWXCwiFRwcXAQRAcR3Zw6KbhoeN6XVNoi3sfl/Ticc7lcwBtQGSv2AijplpFMxKS11Lrke4OHnlOqZrKooiwK/v276/PR9d5PiFlNu3YQ2U9cl84ul3aeAlN//V3Vn8maGv3f1EGNGRbgkYmVbYsJ3iUeMWgp4qrgvMvHgtMunzuelWSc+JZY0gpqhrhJLKc79HwHl4plrbWD2N6f1VeXxRzqUcxhEyYYilBRgQQF4X/8044/ji1yV2BQLo8CLMpESRETssTz0KFhEjJxCEHqkLhz634PrfvJbW3vFZhtcM4v2tpCAzidoZPV29p4BBgaAG7qTDVUR+qh9uZywPsJMJgChu8os2HmwiF3e38M6Hvh/GMM8B0CdpXzryPO7RqFn4Er/QcXKWq8KHerGwAACPVJREFUeNrt1qEVwCAAQ8GA645MwEBMwI7IorpBEX29U9FRPwEAAACALyvPmKvf7gAAeE+7RkmS6goAgLMEFwCA4AIAEFwAAAguAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAAIILAEBwAQAILgAABBcAgOACABBcAAAILgAAwQUAILhcAAAguAAABBcAAIILAEBwAQAILgAABBcAgOACABBcAAAILgAAwQUAgOACABBcAACCCwAAwQUAILgAAAQXAACCCwBAcAEACC4AAAQXAIDgAgBAcAEACC4AAMEFAIDgAgAQXAAAggsAAMEFACC4AAAQXAAAggsAQHABACC4AAAEFwCA4AIAQHABAAguAADBBQCA4AIAEFwAAAguAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAAIILAEBwAQAILgAABBcAgOACABBcAAAILgAAwQUAILgAABBcAACCCwAAwQUAILgAAAQXAACCCwBAcAEACC4AAAQXAIDgAgBAcAEACC4AAMEFAIDgAgAQXAAAggsAAMEFACC4AAAEFwAAggsAQHABACC4AAAEFwCA4AIAQHABAAguAADBBQCA4AIAEFwAAAguAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAgOACAEBwAQAILgAABBcAgOACABBcAAAILgAAwQUAILgAABBcAACCCwAAwQUAILgAAAQXAACCCwBAcAEACC4AAAQXAIDgAgAQXAAACC4AAMEFAIDgAgAQXAAAggsAAMEFACC4AAAEFwAAggsAQHABACC4AAAEFwCA4AIAQHABAAguAADBBQCA4AIAEFwAAIILAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAgOACAEBwAQAILgAABBcAgOACABBcAAAILgAAwQUAILgAABBcAACCCwBAcAEAILgAAAQXAACCCwBAcAEACC4AAAQXAIDgAgAQXAAACC4AAMEFAIDgAgAQXAAAggsAAMEFACC4AAAEFwAAggsAQHABAAguAAAEFwCA4AIAQHABAAguAADBBQCA4AIAEFwAAIILAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAgOACAEBwAQAILgAAwQUAgOACABBcAAAILgAAwQUAILgAABBcAACCCwBAcAEAILgAAAQXAACCCwBAcAEACC4AAAQXAIDgAgAQXAAACC4AAMEFACC4AAAQXAAAggsAAMEFACC4AAAEFwAAggsAQHABAAguAAAEFwCA4AIAQHABAAguAADBBQCA4AIAEFwAAIILAADBBQAguAAABBcAAIILAEBwAQAguAAABBcAgOACAEBwAQAILgAAwQUAgOACABBcAAAILgAAwQUAILgAABBcAACCCwBAcAEAILgAAAQXAIDgAgBAcAEACC4AAAQXAIDgAgAQXAAACC4AAMEFACC4AAAQXAAAggsAQHC5AABAcAEACC4AAAQXAIDgAgAQXAAACC4AAMEFACC4AAAQXAAAggsAAMEFACC4AAAEFwAAggsAQHABAAguAAAEFwCA4AIAEFwAAAguAADBBQCA4AIAEFwAAIILAADBBQAguAAABBcAAIILAEBwAQAguAAABBcAgOACAEBwAQAILgAAwQUAgOACABBcAACCCwAAwQUAILgAABBcAACCCwBAcAEAILgAAAQXAIDgAgBAcAEACC4AAAQXAIDgAgAQXAAACC4AAMEFACC4AAAQXAAAggsAQHABACC4AAAEFwAAggsAQHABAAguAAAEFwCA4AIAEFwAAAguAADBBQCA4AIAEFwAAIILAADBBQAguAAABBcAAIILAEBwAQAILgAABBcAgOACAEBwAQAILgAAwQUAgOACABBcAACCCwAAwQUAILgAABBcAACCCwBAcAEAILgAAAQXAIDgAgBAcAEACC4AAMEFAIDgAgAQXAAACC4AAMEFACC4AAAQXAAAggsAQHABACC4AAAEFwAAggsAQHABAAguAAAEFwCA4AIAEFwAAAguAADBBQAguAAAEFwAAIILAADBBQAguAAABBcAAIILAEBwAQAILgAABBcAgOACAEBwAQAILgAAwQUAgOACABBcAACCCwAAwQUAILgAAAQXAACCCwBAcAEAILgAAAQXAIDgAgBAcAEACC4AAMEFAIDgAgAQXAAACC4AAMEFACC4AAAQXAAAggsAQHABACC4AAAEFwCA4AIAQHABAAguAAAEFwCA4AIAEFwAAAguAADBBQAguAAAEFwAAIILAADBBQAguAAABBcAAIILAEBwAQAILgAABBcAgOACABBcAAAILgAAwQUAgOACABBcAACCCwAAwQUAILgAAAQXAACCCwBAcAEAILgAAAQXAIDgAgBAcAEACC4AAMEFAIDgAgAQXAAAggsAAMEFACC4AAAQXAAAggsAQHABACC4AAAEFwCA4AIAQHABAAguAAAEFwCA4AIAEFwAAAguAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAAIILAEBwAQAILgAABBcAgOACABBcAAAILgAAwQUAgOACABBcAACCCwAAwQUAILgAAAQXAACCCwBAcAEACC4AAAQXAIDgAgBAcAEACC4AAMEFAIDgAgAQXAAAggsAAMEFACC4AAAQXAAAggsAQHABACC4AAAEFwCA4AIAQHABAAguAADBBQCA4AIAEFwAAAguAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAgOByAQCA4AIAEFwAAAguAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAAIILAEBwAQAILgAABBcAgOACABBcAAAILgAAwQUAILgAABBcAACCCwAAwQUAILgAAAQXAACCCwBAcAEACC4AAAQXAIDgAgBAcAEACC4AAMEFAIDgAgAQXAAAggsAAMEFACC4AAAEFwAAggsAQHABACC4AAAEFwCA4AIAQHABAAguAADBBQCA4AIAEFwAAAguAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAgOACAEBwAQAILgAABBcAgOACABBcAAAAAAAAwN9seVEIsPfvTaoAAAAASUVORK5CYII=',
        SECOND_QUARTILE:
          'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAlwAAAJcCAYAAAAsHHqwAAABaWlDQ1BEaXNwbGF5IFAzAAAokXWQvUvDUBTFT6tS0DqIDh0cMolD1NIKdnFoKxRFMFQFq1OafgltfCQpUnETVyn4H1jBWXCwiFRwcXAQRAcR3Zw6KbhoeN6XVNoi3sfl/Ticc7lcwBtQGSv2AijplpFMxKS11Lrke4OHnlOqZrKooiwK/v276/PR9d5PiFlNu3YQ2U9cl84ul3aeAlN//V3Vn8maGv3f1EGNGRbgkYmVbYsJ3iUeMWgp4qrgvMvHgtMunzuelWSc+JZY0gpqhrhJLKc79HwHl4plrbWD2N6f1VeXxRzqUcxhEyYYilBRgQQF4X/8044/ji1yV2BQLo8CLMpESRETssTz0KFhEjJxCEHqkLhz634PrfvJbW3vFZhtcM4v2tpCAzidoZPV29p4BBgaAG7qTDVUR+qh9uZywPsJMJgChu8os2HmwiF3e38M6Hvh/GMM8B0CdpXzryPO7RqFn4Er/QcXKWq8KHerGwAACPVJREFUeNrt1qEVwCAAQ8HAYp0HwzAY5mGyorpBEX29U9FRPwEAAACALyvPaKvf7gAAeM+8RkmS6goAgLMEFwCA4AIAEFwAAAguAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAAIILAEBwAQAILgAABBcAgOACABBcAAAILgAAwQUAILhcAAAguAAABBcAAIILAEBwAQAILgAABBcAgOACABBcAAAILgAAwQUAgOACABBcAACCCwAAwQUAILgAAAQXAACCCwBAcAEACC4AAAQXAIDgAgBAcAEACC4AAMEFAIDgAgAQXAAAggsAAMEFACC4AAAQXAAAggsAQHABACC4AAAEFwCA4AIAQHABAAguAADBBQCA4AIAEFwAAAguAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAAIILAEBwAQAILgAABBcAgOACABBcAAAILgAAwQUAILgAABBcAACCCwAAwQUAILgAAAQXAACCCwBAcAEACC4AAAQXAIDgAgBAcAEACC4AAMEFAIDgAgAQXAAAggsAAMEFACC4AAAEFwAAggsAQHABACC4AAAEFwCA4AIAQHABAAguAADBBQCA4AIAEFwAAAguAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAgOACAEBwAQAILgAABBcAgOACABBcAAAILgAAwQUAILgAABBcAACCCwAAwQUAILgAAAQXAACCCwBAcAEACC4AAAQXAIDgAgAQXAAACC4AAMEFAIDgAgAQXAAAggsAAMEFACC4AAAEFwAAggsAQHABACC4AAAEFwCA4AIAQHABAAguAADBBQCA4AIAEFwAAIILAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAgOACAEBwAQAILgAABBcAgOACABBcAAAILgAAwQUAILgAABBcAACCCwBAcAEAILgAAAQXAACCCwBAcAEACC4AAAQXAIDgAgAQXAAACC4AAMEFAIDgAgAQXAAAggsAAMEFACC4AAAEFwAAggsAQHABAAguAAAEFwCA4AIAQHABAAguAADBBQCA4AIAEFwAAIILAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAgOACAEBwAQAILgAAwQUAgOACABBcAAAILgAAwQUAILgAABBcAACCCwBAcAEAILgAAAQXAACCCwBAcAEACC4AAAQXAIDgAgAQXAAACC4AAMEFACC4AAAQXAAAggsAAMEFACC4AAAEFwAAggsAQHABAAguAAAEFwCA4AIAQHABAAguAADBBQCA4AIAEFwAAIILAADBBQAguAAABBcAAIILAEBwAQAguAAABBcAgOACAEBwAQAILgAAwQUAgOACABBcAAAILgAAwQUAILgAABBcAACCCwBAcAEAILgAAAQXAIDgAgBAcAEACC4AAAQXAIDgAgAQXAAACC4AAMEFACC4AAAQXAAAggsAQHC5AABAcAEACC4AAAQXAIDgAgAQXAAACC4AAMEFACC4AAAQXAAAggsAAMEFACC4AAAEFwAAggsAQHABAAguAAAEFwCA4AIAEFwAAAguAADBBQCA4AIAEFwAAIILAADBBQAguAAABBcAAIILAEBwAQAguAAABBcAgOACAEBwAQAILgAAwQUAgOACABBcAACCCwAAwQUAILgAABBcAACCCwBAcAEAILgAAAQXAIDgAgBAcAEACC4AAAQXAIDgAgAQXAAACC4AAMEFACC4AAAQXAAAggsAQHABACC4AAAEFwAAggsAQHABAAguAAAEFwCA4AIAEFwAAAguAADBBQCA4AIAEFwAAIILAADBBQAguAAABBcAAIILAEBwAQAILgAABBcAgOACAEBwAQAILgAAwQUAgOACABBcAACCCwAAwQUAILgAABBcAACCCwBAcAEAILgAAAQXAIDgAgBAcAEACC4AAMEFAIDgAgAQXAAACC4AAMEFACC4AAAQXAAAggsAQHABACC4AAAEFwAAggsAQHABAAguAAAEFwCA4AIAEFwAAAguAADBBQAguAAAEFwAAIILAADBBQAguAAABBcAAIILAEBwAQAILgAABBcAgOACAEBwAQAILgAAwQUAgOACABBcAACCCwAAwQUAILgAAAQXAACCCwBAcAEAILgAAAQXAIDgAgBAcAEACC4AAMEFAIDgAgAQXAAACC4AAMEFACC4AAAQXAAAggsAQHABACC4AAAEFwCA4AIAQHABAAguAAAEFwCA4AIAEFwAAAguAADBBQAguAAAEFwAAIILAADBBQAguAAABBcAAIILAEBwAQAILgAABBcAgOACABBcAAAILgAAwQUAgOACABBcAACCCwAAwQUAILgAAAQXAACCCwBAcAEAILgAAAQXAIDgAgBAcAEACC4AAMEFAIDgAgAQXAAAggsAAMEFACC4AAAQXAAAggsAQHABACC4AAAEFwCA4AIAQHABAAguAAAEFwCA4AIAEFwAAAguAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAAIILAEBwAQAILgAABBcAgOACABBcAAAILgAAwQUAgOACABBcAACCCwAAwQUAILgAAAQXAACCCwBAcAEACC4AAAQXAIDgAgBAcAEACC4AAMEFAIDgAgAQXAAAggsAAMEFACC4AAAQXAAAggsAQHABACC4AAAEFwCA4AIAQHABAAguAADBBQCA4AIAEFwAAAguAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAgOByAQCA4AIAEFwAAAguAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAAIILAEBwAQAILgAABBcAgOACABBcAAAILgAAwQUAILgAABBcAACCCwAAwQUAILgAAAQXAACCCwBAcAEACC4AAAQXAIDgAgBAcAEACC4AAMEFAIDgAgAQXAAAggsAAMEFACC4AAAEFwAAggsAQHABACC4AAAEFwCA4AIAQHABAAguAADBBQCA4AIAEFwAAAguAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAgOACAEBwAQAILgAABBcAgOACABBcAAAAAAAAwN9sezUIsPGSzlYAAAAASUVORK5CYII=',
        THIRD_QUARTILE:
          'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAlwAAAJcCAYAAAAsHHqwAAABaWlDQ1BEaXNwbGF5IFAzAAAokXWQvUvDUBTFT6tS0DqIDh0cMolD1NIKdnFoKxRFMFQFq1OafgltfCQpUnETVyn4H1jBWXCwiFRwcXAQRAcR3Zw6KbhoeN6XVNoi3sfl/Ticc7lcwBtQGSv2AijplpFMxKS11Lrke4OHnlOqZrKooiwK/v276/PR9d5PiFlNu3YQ2U9cl84ul3aeAlN//V3Vn8maGv3f1EGNGRbgkYmVbYsJ3iUeMWgp4qrgvMvHgtMunzuelWSc+JZY0gpqhrhJLKc79HwHl4plrbWD2N6f1VeXxRzqUcxhEyYYilBRgQQF4X/8044/ji1yV2BQLo8CLMpESRETssTz0KFhEjJxCEHqkLhz634PrfvJbW3vFZhtcM4v2tpCAzidoZPV29p4BBgaAG7qTDVUR+qh9uZywPsJMJgChu8os2HmwiF3e38M6Hvh/GMM8B0CdpXzryPO7RqFn4Er/QcXKWq8KHerGwAACPVJREFUeNrt1qENwCAARNGDGZugmQxNwo5FdYMimr6nTp/6CQAAAAB8WXnGNdrtDgCA96w+S5JUVwAAnCW4AAAEFwCA4AIAQHABAAguAADBBQCA4AIAEFwAAIILAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAgOACAEBwAQAILgAAweUCAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAgOACAEBwAQAILgAABBcAgOACABBcAAAILgAAwQUAILgAABBcAACCCwBAcAEAILgAAAQXAACCCwBAcAEACC4AAAQXAIDgAgAQXAAACC4AAMEFAIDgAgAQXAAAggsAAMEFACC4AAAEFwAAggsAQHABAAguAAAEFwCA4AIAQHABAAguAADBBQCA4AIAEFwAAIILAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAgOACAEBwAQAILgAAwQUAgOACABBcAAAILgAAwQUAILgAABBcAACCCwBAcAEAILgAAAQXAACCCwBAcAEACC4AAAQXAIDgAgAQXAAACC4AAMEFACC4AAAQXAAAggsAAMEFACC4AAAEFwAAggsAQHABAAguAAAEFwCA4AIAQHABAAguAADBBQCA4AIAEFwAAIILAADBBQAguAAABBcAAIILAEBwAQAguAAABBcAgOACAEBwAQAILgAAwQUAgOACABBcAAAILgAAwQUAILgAABBcAACCCwBAcAEAILgAAAQXAIDgAgBAcAEACC4AAAQXAIDgAgAQXAAACC4AAMEFACC4AAAQXAAAggsAAMEFACC4AAAEFwAAggsAQHABAAguAAAEFwCA4AIAEFwAAAguAADBBQCA4AIAEFwAAIILAADBBQAguAAABBcAAIILAEBwAQAguAAABBcAgOACAEBwAQAILgAAwQUAgOACABBcAACCCwAAwQUAILgAABBcAACCCwBAcAEAILgAAAQXAIDgAgBAcAEACC4AAAQXAIDgAgAQXAAACC4AAMEFACC4AAAQXAAAggsAQHABACC4AAAEFwAAggsAQHABAAguAAAEFwCA4AIAEFwAAAguAADBBQCA4AIAEFwAAIILAADBBQAguAAABBcAAIILAEBwAQAILgAABBcAgOACAEBwAQAILgAAwQUAgOACABBcAACCCwAAwQUAILgAABBcAACCCwBAcAEAILgAAAQXAIDgAgBAcAEACC4AAMEFAIDgAgAQXAAACC4AAMEFACC4AAAQXAAAggsAQHABACC4AAAEFwAAggsAQHABAAguAAAEFwCA4AIAEFwAAAguAADBBQAguAAAEFwAAIILAADBBQAguAAABBcAAIILAEBwAQAILgAABBcAgOACAEBwAQAILgAAwQUAgOACABBcAACCCwAAwQUAILgAAAQXAACCCwBAcAEAILgAAAQXAIDgAgBAcAEACC4AAMEFAIDgAgAQXAAAgssFAACCCwBAcAEAILgAAAQXAIDgAgBAcAEACC4AAMEFAIDgAgAQXAAACC4AAMEFACC4AAAQXAAAggsAQHABACC4AAAEFwCA4AIAQHABAAguAAAEFwCA4AIAEFwAAAguAADBBQAguAAAEFwAAIILAADBBQAguAAABBcAAIILAEBwAQAILgAABBcAgOACABBcAAAILgAAwQUAgOACABBcAACCCwAAwQUAILgAAAQXAACCCwBAcAEAILgAAAQXAIDgAgBAcAEACC4AAMEFAIDgAgAQXAAAggsAAMEFACC4AAAQXAAAggsAQHABACC4AAAEFwCA4AIAQHABAAguAAAEFwCA4AIAEFwAAAguAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAAIILAEBwAQAILgAABBcAgOACABBcAAAILgAAwQUAgOACABBcAACCCwAAwQUAILgAAAQXAACCCwBAcAEACC4AAAQXAIDgAgBAcAEACC4AAMEFAIDgAgAQXAAAggsAAMEFACC4AAAQXAAAggsAQHABACC4AAAEFwCA4AIAQHABAAguAADBBQCA4AIAEFwAAAguAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAAIILAEBwAQAILgAABBcAgOACABBcAAAILgAAwQUAILgAABBcAACCCwAAwQUAILgAAAQXAACCCwBAcAEACC4AAAQXAIDgAgBAcAEACC4AAMEFAIDgAgAQXAAAggsAAMEFACC4AAAEFwAAggsAQHABACC4AAAEFwCA4AIAQHABAAguAADBBQCA4AIAEFwAAAguAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAgOACAEBwAQAILgAABBcAgOACABBcAAAILgAAwQUAILgAABBcAACCCwAAwQUAILgAAAQXAACCCwBAcAEACC4AAAQXAIDgAgAQXAAACC4AAMEFAIDgAgAQXAAAggsAAMEFACC4AAAEFwAAggsAQHABACC4AAAEFwCA4AIAQHABAAguAADBBQCA4AIAEFwAAIILAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAgOACAEBwAQAILgAABBcAgOACABBcAAAILgAAwQUAILgAABBcAACCCwBAcAEAILgAAAQXAACCCwBAcAEACC4AAAQXAIDgAgAQXAAACC4AAMEFAIDgAgAQXAAAggsAAMEFACC4AAAEFwAAggsAQHABAAguAAAEFwCA4AIAQHABAAguAADBBQCA4AIAEFwAAIILAADBBQAguAAABJcLAAAEFwCA4AIAQHABAAguAADBBQCA4AIAEFwAAIILAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAgOACAEBwAQAILgAAwQUAgOACABBcAAAILgAAwQUAILgAABBcAACCCwBAcAEAILgAAAQXAACCCwBAcAEACC4AAAQXAIDgAgAQXAAACC4AAMEFACC4AAAQXAAAggsAAMEFACC4AAAEFwAAggsAQHABAAguAAAEFwCA4AIAQHABAAguAADBBQCA4AIAEFwAAIILAADBBQAguAAABBcAAIILAEBwAQAguAAABBcAgOACAAAAAAAA/mYDn8gIsNXw0FUAAAAASUVORK5CYII=',
        FOURTH_QUARTILE:
          'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAlwAAAJcCAYAAAAsHHqwAAABaWlDQ1BEaXNwbGF5IFAzAAAokXWQvUvDUBTFT6tS0DqIDh0cMolD1NIKdnFoKxRFMFQFq1OafgltfCQpUnETVyn4H1jBWXCwiFRwcXAQRAcR3Zw6KbhoeN6XVNoi3sfl/Ticc7lcwBtQGSv2AijplpFMxKS11Lrke4OHnlOqZrKooiwK/v276/PR9d5PiFlNu3YQ2U9cl84ul3aeAlN//V3Vn8maGv3f1EGNGRbgkYmVbYsJ3iUeMWgp4qrgvMvHgtMunzuelWSc+JZY0gpqhrhJLKc79HwHl4plrbWD2N6f1VeXxRzqUcxhEyYYilBRgQQF4X/8044/ji1yV2BQLo8CLMpESRETssTz0KFhEjJxCEHqkLhz634PrfvJbW3vFZhtcM4v2tpCAzidoZPV29p4BBgaAG7qTDVUR+qh9uZywPsJMJgChu8os2HmwiF3e38M6Hvh/GMM8B0CdpXzryPO7RqFn4Er/QcXKWq8KHerGwAACPVJREFUeNrt1qEVwCAAQ8HAVFVMxDhMhGKrorpBEX29U9FRPwEAAACALyvPuHq73QEA8J41ZkmS6goAgLMEFwCA4AIAEFwAAAguAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAAIILAEBwAQAILgAABBcAgOACABBcAAAILgAAwQUAILhcAAAguAAABBcAAIILAEBwAQAILgAABBcAgOACABBcAAAILgAAwQUAgOACABBcAACCCwAAwQUAILgAAAQXAACCCwBAcAEACC4AAAQXAIDgAgBAcAEACC4AAMEFAIDgAgAQXAAAggsAAMEFACC4AAAQXAAAggsAQHABACC4AAAEFwCA4AIAQHABAAguAADBBQCA4AIAEFwAAAguAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAAIILAEBwAQAILgAABBcAgOACABBcAAAILgAAwQUAILgAABBcAACCCwAAwQUAILgAAAQXAACCCwBAcAEACC4AAAQXAIDgAgBAcAEACC4AAMEFAIDgAgAQXAAAggsAAMEFACC4AAAEFwAAggsAQHABACC4AAAEFwCA4AIAQHABAAguAADBBQCA4AIAEFwAAAguAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAgOACAEBwAQAILgAABBcAgOACABBcAAAILgAAwQUAILgAABBcAACCCwAAwQUAILgAAAQXAACCCwBAcAEACC4AAAQXAIDgAgAQXAAACC4AAMEFAIDgAgAQXAAAggsAAMEFACC4AAAEFwAAggsAQHABACC4AAAEFwCA4AIAQHABAAguAADBBQCA4AIAEFwAAIILAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAgOACAEBwAQAILgAABBcAgOACABBcAAAILgAAwQUAILgAABBcAACCCwBAcAEAILgAAAQXAACCCwBAcAEACC4AAAQXAIDgAgAQXAAACC4AAMEFAIDgAgAQXAAAggsAAMEFACC4AAAEFwAAggsAQHABAAguAAAEFwCA4AIAQHABAAguAADBBQCA4AIAEFwAAIILAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAgOACAEBwAQAILgAAwQUAgOACABBcAAAILgAAwQUAILgAABBcAACCCwBAcAEAILgAAAQXAACCCwBAcAEACC4AAAQXAIDgAgAQXAAACC4AAMEFACC4AAAQXAAAggsAAMEFACC4AAAEFwAAggsAQHABAAguAAAEFwCA4AIAQHABAAguAADBBQCA4AIAEFwAAIILAADBBQAguAAABBcAAIILAEBwAQAguAAABBcAgOACAEBwAQAILgAAwQUAgOACABBcAAAILgAAwQUAILgAABBcAACCCwBAcAEAILgAAAQXAIDgAgBAcAEACC4AAAQXAIDgAgAQXAAACC4AAMEFACC4AAAQXAAAggsAQHC5AABAcAEACC4AAAQXAIDgAgAQXAAACC4AAMEFACC4AAAQXAAAggsAAMEFACC4AAAEFwAAggsAQHABAAguAAAEFwCA4AIAEFwAAAguAADBBQCA4AIAEFwAAIILAADBBQAguAAABBcAAIILAEBwAQAguAAABBcAgOACAEBwAQAILgAAwQUAgOACABBcAACCCwAAwQUAILgAABBcAACCCwBAcAEAILgAAAQXAIDgAgBAcAEACC4AAAQXAIDgAgAQXAAACC4AAMEFACC4AAAQXAAAggsAQHABACC4AAAEFwAAggsAQHABAAguAAAEFwCA4AIAEFwAAAguAADBBQCA4AIAEFwAAIILAADBBQAguAAABBcAAIILAEBwAQAILgAABBcAgOACAEBwAQAILgAAwQUAgOACABBcAACCCwAAwQUAILgAABBcAACCCwBAcAEAILgAAAQXAIDgAgBAcAEACC4AAMEFAIDgAgAQXAAACC4AAMEFACC4AAAQXAAAggsAQHABACC4AAAEFwAAggsAQHABAAguAAAEFwCA4AIAEFwAAAguAADBBQAguAAAEFwAAIILAADBBQAguAAABBcAAIILAEBwAQAILgAABBcAgOACAEBwAQAILgAAwQUAgOACABBcAACCCwAAwQUAILgAAAQXAACCCwBAcAEAILgAAAQXAIDgAgBAcAEACC4AAMEFAIDgAgAQXAAACC4AAMEFACC4AAAQXAAAggsAQHABACC4AAAEFwCA4AIAQHABAAguAAAEFwCA4AIAEFwAAAguAADBBQAguAAAEFwAAIILAADBBQAguAAABBcAAIILAEBwAQAILgAABBcAgOACABBcAAAILgAAwQUAgOACABBcAACCCwAAwQUAILgAAAQXAACCCwBAcAEAILgAAAQXAIDgAgBAcAEACC4AAMEFAIDgAgAQXAAAggsAAMEFACC4AAAQXAAAggsAQHABACC4AAAEFwCA4AIAQHABAAguAAAEFwCA4AIAEFwAAAguAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAAIILAEBwAQAILgAABBcAgOACABBcAAAILgAAwQUAgOACABBcAACCCwAAwQUAILgAAAQXAACCCwBAcAEACC4AAAQXAIDgAgBAcAEACC4AAMEFAIDgAgAQXAAAggsAAMEFACC4AAAQXAAAggsAQHABACC4AAAEFwCA4AIAQHABAAguAADBBQCA4AIAEFwAAAguAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAgOByAQCA4AIAEFwAAAguAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAAIILAEBwAQAILgAABBcAgOACABBcAAAILgAAwQUAILgAABBcAACCCwAAwQUAILgAAAQXAACCCwBAcAEACC4AAAQXAIDgAgBAcAEACC4AAMEFAIDgAgAQXAAAggsAAMEFACC4AAAEFwAAggsAQHABACC4AAAEFwCA4AIAQHABAAguAADBBQCA4AIAEFwAAAguAADBBQAguAAAEFwAAIILAEBwAQAguAAABBcAgOACAEBwAQAILgAABBcAgOACABBcAAAAAAAAwN9s0IwIsM2sTdYAAAAASUVORK5CYII=',
      });

      const DestinationEnum = Object.freeze({
        HARDWARE_AND_SOFTWARE: 0,
        HARDWARE_ONLY: 1,
        SOFTWARE_ONLY: 2,
      });
      const ContributionLevels = [
        'FIRST_QUARTILE',
        'SECOND_QUARTILE',
        'THIRD_QUARTILE',
        'FOURTH_QUARTILE',
      ];

      const counterAction = {
        type: 'com.elgato.counter.action-clone',

        onKeyDown: function (
          context,
          settings,
          coordinates,
          userDesiredState,
        ) {},

        onKeyUp: function (context, settings, coordinates, userDesiredState) {
          fetch('http://localhost:80/', {
            method: 'POST',
            headers: {},
            body: JSON.stringify({}),
          }).then((resp) => {
            resp.json().then((data) => {
              console.log({ data });
              this.SetTitle(context, data.contributionCount);
              this.SetImage(context, data.contributionLevel);
            });
          });
        },

        onWillAppear: function (context, settings, coordinates) {
          fetch('http://localhost:80/', {
            method: 'POST',
            headers: {},
            body: JSON.stringify({}),
          }).then((resp) => {
            resp.json().then((data) => {
              this.SetTitle(context, data.contributionCount);
              this.SetImage(context, data.contributionLevel);
            });
          });
        },

        SetTitle: function (context, contributionCount) {
          const now = new Date();
          const month = (now.getMonth() + 1).toString().padStart(2, '0');
          const date = now.getDate().toString().padStart(2, '0');
          const hour = now.getHours().toString().padStart(2, '0');

          websocket.send(
            JSON.stringify({
              event: 'setTitle',
              context: context,
              payload: {
                title: `${month}/${date} ` + contributionCount + '件',
                target: DestinationEnum.HARDWARE_AND_SOFTWARE,
              },
            }),
          );
        },

        SetImage: function (context, quartile) {
          if (!ContributionLevels.includes(quartile)) {
            console.warn('unexpected quartile: ' + quartile);
            return;
          }

          console.log({ context });

          websocket.send(
            JSON.stringify({
              event: 'setImage',
              context: context,
              payload: {
                image: quartileImage[quartile],
                target: DestinationEnum.HARDWARE_AND_SOFTWARE,
              },
            }),
          );
        },
      };

      const connectElgatoStreamDeckSocket = (
        inPort,
        inPluginUUID,
        inRegisterEvent,
        inInfo,
      ) => {
        pluginUUID = inPluginUUID;

        // Open the web socket
        websocket = new WebSocket('ws://127.0.0.1:' + inPort);

        const registerPlugin = (inPluginUUID) => {
          websocket.send(
            JSON.stringify({
              event: inRegisterEvent,
              uuid: inPluginUUID,
            }),
          );
        };

        websocket.onopen = () => {
          // WebSocket is connected, send message
          registerPlugin(pluginUUID);
        };

        websocket.onmessage = (evt) => {
          // Received message from Stream Deck
          const jsonObj = JSON.parse(evt.data);
          const { event, action, context, payload } = jsonObj;

          if (event == 'keyDown') {
            const { settings, coordinates, userDesiredState } = payload;
            counterAction.onKeyDown(
              context,
              settings,
              coordinates,
              userDesiredState,
            );
          } else if (event == 'keyUp') {
            const { settings, coordinates, userDesiredState } = payload;
            counterAction.onKeyUp(
              context,
              settings,
              coordinates,
              userDesiredState,
            );
          } else if (event == 'willAppear') {
            const { settings, coordinates } = payload;
            counterAction.onWillAppear(context, settings, coordinates);
          }
        };

        websocket.onclose = function () {
          // Websocket is closed
        };
      };
    </script>
  </body>
</html>
